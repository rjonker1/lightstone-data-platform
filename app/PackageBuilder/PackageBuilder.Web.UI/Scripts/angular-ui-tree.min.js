(function(){"use strict";angular.module("ui.tree",[]).constant("treeConfig",{treeClass:"angular-ui-tree",emptyTreeClass:"angular-ui-tree-empty",hiddenClass:"angular-ui-tree-hidden",nodesClass:"angular-ui-tree-nodes",nodeClass:"angular-ui-tree-node",handleClass:"angular-ui-tree-handle",placeHolderClass:"angular-ui-tree-placeholder",dragClass:"angular-ui-tree-drag",dragThreshold:3,levelThreshold:30})})(),function(){"use strict";angular.module("ui.tree").factory("$uiTreeHelper",["$document","$window",function(n,t){return{nodesData:{},setNodeAttribute:function(n,t,i){var r=this.nodesData[n.$modelValue.$$hashKey];r||(r={},this.nodesData[n.$modelValue.$$hashKey]=r);r[t]=i},getNodeAttribute:function(n,t){var i=this.nodesData[n.$modelValue.$$hashKey];return i?i[t]:null},nodrag:function(n){return typeof n.attr("data-nodrag")!="undefined"},eventObj:function(n){var t=n;return n.targetTouches!==undefined?t=n.targetTouches.item(0):n.originalEvent!==undefined&&n.originalEvent.targetTouches!==undefined&&(t=n.originalEvent.targetTouches.item(0)),t},dragInfo:function(n){return{source:n,sourceInfo:{nodeScope:n,index:n.index(),nodesScope:n.$parentNodesScope},index:n.index(),siblings:n.siblings().slice(0),parent:n.$parentNodesScope,moveTo:function(n,t,i){this.parent=n;this.siblings=t.slice(0);var r=this.siblings.indexOf(this.source);r>-1&&(this.siblings.splice(r,1),this.source.index()<i&&i--);this.siblings.splice(i,0,this.source);this.index=i},parentNode:function(){return this.parent.$nodeScope},prev:function(){return this.index>0?this.siblings[this.index-1]:null},next:function(){return this.index<this.siblings.length-1?this.siblings[this.index+1]:null},isDirty:function(){return this.source.$parentNodesScope!=this.parent||this.source.index()!=this.index},eventArgs:function(n,t){return{source:this.sourceInfo,dest:{index:this.index,nodesScope:this.parent},elements:n,pos:t}},apply:function(){var n=this.source.$modelValue;this.source.remove();this.parent.insertNode(this.index,n)}}},height:function(n){return n.prop("scrollHeight")},width:function(n){return n.prop("scrollWidth")},offset:function(i){var r=i[0].getBoundingClientRect();return{width:i.prop("offsetWidth"),height:i.prop("offsetHeight"),top:r.top+(t.pageYOffset||n[0].body.scrollTop||n[0].documentElement.scrollTop),left:r.left+(t.pageXOffset||n[0].body.scrollLeft||n[0].documentElement.scrollLeft)}},positionStarted:function(n,t){var i={};return i.offsetX=n.pageX-this.offset(t).left,i.offsetY=n.pageY-this.offset(t).top,i.startX=i.lastX=n.pageX,i.startY=i.lastY=n.pageY,i.nowX=i.nowY=i.distX=i.distY=i.dirAx=0,i.dirX=i.dirY=i.lastDirX=i.lastDirY=i.distAxX=i.distAxY=0,i},positionMoved:function(n,t,i){t.lastX=t.nowX;t.lastY=t.nowY;t.nowX=n.pageX;t.nowY=n.pageY;t.distX=t.nowX-t.lastX;t.distY=t.nowY-t.lastY;t.lastDirX=t.dirX;t.lastDirY=t.dirY;t.dirX=t.distX===0?0:t.distX>0?1:-1;t.dirY=t.distY===0?0:t.distY>0?1:-1;var r=Math.abs(t.distX)>Math.abs(t.distY)?1:0;if(i){t.dirAx=r;t.moving=!0;return}t.dirAx!==r?(t.distAxX=0,t.distAxY=0):(t.distAxX+=Math.abs(t.distX),t.dirX!==0&&t.dirX!==t.lastDirX&&(t.distAxX=0),t.distAxY+=Math.abs(t.distY),t.dirY!==0&&t.dirY!==t.lastDirY&&(t.distAxY=0));t.dirAx=r}}}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeController",["$scope","$element","$attrs","treeConfig",function(n,t){this.scope=n;n.$element=t;n.$nodesScope=null;n.$type="uiTree";n.$emptyElm=null;n.$callbacks=null;n.dragEnabled=!0;n.maxDepth=0;n.dragDelay=0;n.isEmpty=function(){return n.$nodesScope&&n.$nodesScope.$modelValue&&n.$nodesScope.$modelValue.length===0};n.place=function(t){n.$nodesScope.$element.append(t);n.$emptyElm.remove()};n.resetEmptyElement=function(){n.$nodesScope.$modelValue.length===0?t.append(n.$emptyElm):n.$emptyElm.remove()};var i=function(n,t){for(var f,u=n.childNodes(),r=0;r<u.length;r++)t?u[r].collapse():u[r].expand(),f=u[r].$childNodesScope,f&&i(f,t)};n.collapseAll=function(){i(n.$nodesScope,!0)};n.expandAll=function(){i(n.$nodesScope,!1)}}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeNodesController",["$scope","$element","$timeout","treeConfig",function(n,t,i){this.scope=n;n.$element=t;n.$modelValue=null;n.$nodeScope=null;n.$treeScope=null;n.$type="uiTreeNodes";n.$nodesMap={};n.nodrop=!1;n.maxDepth=0;n.initSubNode=function(t){i(function(){n.$nodesMap[t.$modelValue.$$hashKey]=t})};n.destroySubNode=function(t){n.$nodesMap[t.$modelValue.$$hashKey]=null};n.accept=function(t,i){return n.$treeScope.$callbacks.accept(t,n,i)};n.isParent=function(t){return t.$parentNodesScope==n};n.hasChild=function(){return n.$modelValue.length>0};n.safeApply=function(n){var t=this.$root.$$phase;t=="$apply"||t=="$digest"?n&&typeof n=="function"&&n():this.$apply(n)};n.removeNode=function(t){var i=n.$modelValue.indexOf(t.$modelValue);return i>-1?(n.safeApply(function(){n.$modelValue.splice(i,1)[0]}),t):null};n.insertNode=function(t,i){n.safeApply(function(){n.$modelValue.splice(t,0,i)})};n.childNodes=function(){var i=[],t;if(n.$modelValue)for(t=0;t<n.$modelValue.length;t++)i.push(n.$nodesMap[n.$modelValue[t].$$hashKey]);return i};n.depth=function(){return n.$nodeScope?n.$nodeScope.depth():0};n.outOfDepth=function(t){var i=n.maxDepth||n.$treeScope.maxDepth;return i>0?n.depth()+t.maxSubDepth()+1>i:!1}}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeNodeController",["$scope","$element","$attrs","treeConfig",function(n,t){this.scope=n;n.$element=t;n.$modelValue=null;n.$parentNodeScope=null;n.$childNodesScope=null;n.$parentNodesScope=null;n.$treeScope=null;n.$handleScope=null;n.$type="uiTreeNode";n.$$apply=!1;n.collapsed=!1;n.init=function(i){var r=i[0];n.$treeScope=i[1]?i[1].scope:null;n.$parentNodeScope=r.scope.$nodeScope;n.$modelValue=r.scope.$modelValue[n.$index];n.$parentNodesScope=r.scope;r.scope.initSubNode(n);t.on("$destroy",function(){r.scope.destroySubNode(n)})};n.index=function(){return n.$parentNodesScope.$modelValue.indexOf(n.$modelValue)};n.dragEnabled=function(){return!(n.$treeScope&&!n.$treeScope.dragEnabled)};n.isSibling=function(t){return n.$parentNodesScope==t.$parentNodesScope};n.isChild=function(t){var i=n.childNodes();return i&&i.indexOf(t)>-1};n.prev=function(){var t=n.index();return t>0?n.siblings()[t-1]:null};n.siblings=function(){return n.$parentNodesScope.childNodes()};n.childNodesCount=function(){return n.childNodes()?n.childNodes().length:0};n.hasChild=function(){return n.childNodesCount()>0};n.childNodes=function(){return n.$childNodesScope&&n.$childNodesScope.$modelValue?n.$childNodesScope.childNodes():null};n.accept=function(t,i){return n.$childNodesScope&&n.$childNodesScope.accept(t,i)};n.remove=function(){return n.$parentNodesScope.removeNode(n)};n.toggle=function(){n.collapsed=!n.collapsed};n.collapse=function(){n.collapsed=!0};n.expand=function(){n.collapsed=!1};n.depth=function(){var t=n.$parentNodeScope;return t?t.depth()+1:1};var i=0,r=function(n){for(var u,f=0,e=n.childNodes(),t=0;t<e.length;t++)u=e[t].$childNodesScope,u&&(f=1,r(u));i+=f};n.maxSubDepth=function(){return i=0,n.$childNodesScope&&r(n.$childNodesScope),i}}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeHandleController",["$scope","$element","$attrs","treeConfig",function(n,t){this.scope=n;n.$element=t;n.$nodeScope=null;n.$type="uiTreeHandle"}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTree",["treeConfig","$window",function(n,t){return{restrict:"A",scope:!0,controller:"TreeController",link:function(i,r,u){var f={accept:null},e={};angular.extend(e,n);e.treeClass&&r.addClass(e.treeClass);i.$emptyElm=angular.element(t.document.createElement("div"));e.emptyTreeClass&&i.$emptyElm.addClass(e.emptyTreeClass);i.$watch("$nodesScope.$modelValue.length",function(){i.$nodesScope.$modelValue&&i.resetEmptyElement()},!0);u.$observe("dragEnabled",function(n){var t=i.$eval(n);typeof t=="boolean"&&(i.dragEnabled=t)});u.$observe("maxDepth",function(n){var t=i.$eval(n);typeof t=="number"&&(i.maxDepth=t)});u.$observe("dragDelay",function(n){var t=i.$eval(n);typeof t=="number"&&(i.dragDelay=t)});f.accept=function(n,t){return t.nodrop||t.outOfDepth(n)?!1:!0};f.dropped=function(){};f.dragStart=function(){};f.dragMove=function(){};f.dragStop=function(){};i.$watch(u.uiTree,function(n){angular.forEach(n,function(n,t){f[t]&&typeof n=="function"&&(f[t]=n)});i.$callbacks=f},!0)}}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTreeNodes",["treeConfig","$window",function(n){return{require:["ngModel","?^uiTreeNode","^uiTree"],restrict:"A",scope:!0,controller:"TreeNodesController",link:function(t,i,r,u){var e={};angular.extend(e,n);e.nodesClass&&i.addClass(e.nodesClass);var f=u[0],o=u[1],s=u[2];o?(o.scope.$childNodesScope=t,t.$nodeScope=o.scope):s.scope.$nodesScope=t;t.$treeScope=s.scope;f&&(f.$render=function(){f.$modelValue&&angular.isArray(f.$modelValue)||f.$setViewValue([]);t.$modelValue=f.$modelValue});r.$observe("maxDepth",function(n){var i=t.$eval(n);typeof i=="number"&&(t.maxDepth=i)});r.$observe("nodrop",function(n){t.nodrop=typeof n!="undefined"})}}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTreeNode",["treeConfig","$uiTreeHelper","$window","$document","$timeout",function(n,t,i,r,u){return{require:["^uiTreeNodes","^uiTree"],restrict:"A",controller:"TreeNodeController",link:function(f,e,o,s){var v={};angular.extend(v,n);v.nodeClass&&e.addClass(v.nodeClass);f.init(s);f.collapsed=!!t.getNodeAttribute(f,"collapsed");o.$observe("collapsed",function(n){var t=f.$eval(n);typeof t=="boolean"&&(f.collapsed=t)});f.$watch("collapsed",function(n){t.setNodeAttribute(f,"collapsed",n);o.$set("collapsed",n)});var ut="ontouchstart"in window,b,c,l,a,k,h,p=null,w,nt=null,ft=function(n){var u,o,p,s,g;if((ut||n.button!=2&&n.which!=3)&&!n.uiTreeDragging&&(!n.originalEvent||!n.originalEvent.uiTreeDragging)&&(u=angular.element(n.target),o=u.scope(),o&&o.$type)&&(o.$type=="uiTreeNode"||o.$type=="uiTreeHandle")&&(o.$type!="uiTreeNode"||!o.$handleScope)){while(u&&u[0]&&u[0]!=e){if(t.nodrag(u))return;u=u.parent()}n.uiTreeDragging=!0;n.originalEvent&&(n.originalEvent.uiTreeDragging=!0);n.preventDefault();p=t.eventObj(n);b=!0;c=t.dragInfo(f);s=f.$element.prop("tagName");s.toLowerCase()==="tr"?(a=angular.element(i.document.createElement(s)),g=angular.element(i.document.createElement("td")).addClass(v.placeHolderClass),a.append(g)):a=angular.element(i.document.createElement(s)).addClass(v.placeHolderClass);k=angular.element(i.document.createElement(s));v.hiddenClass&&k.addClass(v.hiddenClass);l=t.positionStarted(p,f.$element);a.css("height",t.height(f.$element)+"px");h=angular.element(i.document.createElement(f.$parentNodesScope.$element.prop("tagName"))).addClass(f.$parentNodesScope.$element.attr("class")).addClass(v.dragClass);h.css("width",t.width(f.$element)+"px");h.css("z-index",9999);f.$element.after(a);f.$element.after(k);h.append(f.$element);r.find("body").append(h);h.css({left:p.pageX-l.offsetX+"px",top:p.pageY-l.offsetY+"px"});w={placeholder:a,dragging:h};f.$apply(function(){f.$callbacks.dragStart(c.eventArgs(w,l))});angular.element(r).bind("touchend",y);angular.element(r).bind("touchcancel",y);angular.element(r).bind("touchmove",d);angular.element(r).bind("mouseup",y);angular.element(r).bind("mousemove",d);angular.element(i.document.body).bind("mouseleave",it)}},et=function(n){var s=t.eventObj(n),u,d,e,o,k,r,y,tt;if(h){if(n.preventDefault(),i.getSelection().removeAllRanges(),h.css({left:s.pageX-l.offsetX+"px",top:s.pageY-l.offsetY+"px"}),t.positionMoved(n,l,b),b){b=!1;return}l.dirAx&&l.distAxX>=v.levelThreshold&&(l.distAxX=0,l.distX>0&&(u=c.prev(),u&&!u.collapsed&&u.accept(f,u.childNodesCount())&&(u.$childNodesScope.$element.append(a),c.moveTo(u.$childNodesScope,u.childNodes(),u.childNodesCount()))),l.distX<0&&(d=c.next(),d||(e=c.parentNode(),e&&e.$parentNodesScope.accept(f,e.index()+1)&&(e.$element.after(a),c.moveTo(e.$parentNodesScope,e.siblings(),e.index()+1)))));var it=t.offset(h).left-t.offset(a).left>=v.threshold,g=s.pageX-i.document.body.scrollLeft,nt=s.pageY-(window.pageYOffset||i.document.documentElement.scrollTop);if(angular.isFunction(h.hide)&&h.hide(),i.document.elementFromPoint(g,nt),o=angular.element(i.document.elementFromPoint(g,nt)),angular.isFunction(h.show)&&h.show(),!l.dirAx){if(r=o.scope(),y=!1,r.$type=="uiTree"&&r.dragEnabled&&(y=r.isEmpty()),r.$type=="uiTreeHandle"&&(r=r.$nodeScope),r.$type!="uiTreeNode"&&!y)return;p&&a.parent()[0]!=p.$element[0]&&(p.resetEmptyElement(),p=null);y?(p=r,r.$nodesScope.accept(f,0)&&(r.place(a),c.moveTo(r.$nodesScope,r.$nodesScope.childNodes(),0))):r.dragEnabled()&&(o=r.$element,tt=t.offset(o),k=s.pageY<tt.top+t.height(o)/2,r.$parentNodesScope.accept(f,r.index())?k?(o[0].parentNode.insertBefore(a[0],o[0]),c.moveTo(r.$parentNodesScope,r.siblings(),r.index())):(o.after(a),c.moveTo(r.$parentNodesScope,r.siblings(),r.index()+1)):!k&&r.accept(f,r.childNodesCount())&&(r.$childNodesScope.$element.append(a),c.moveTo(r.$childNodesScope,r.childNodes(),r.childNodesCount())))}f.$apply(function(){f.$callbacks.dragMove(c.eventArgs(w,l))})}},g=function(n){n.preventDefault();h&&(k.replaceWith(f.$element),a.remove(),h.remove(),h=null,f.$$apply?(c.apply(),f.$treeScope.$apply(function(){f.$callbacks.dropped(c.eventArgs(w,l))})):rt(),f.$treeScope.$apply(function(){f.$callbacks.dragStop(c.eventArgs(w,l))}),f.$$apply=!1,c=null);angular.element(r).unbind("touchend",y);angular.element(r).unbind("touchcancel",y);angular.element(r).unbind("touchmove",d);angular.element(r).unbind("mouseup",y);angular.element(r).unbind("mousemove",d);angular.element(i.document.body).unbind("mouseleave",it)},tt=function(n){f.dragEnabled()&&ft(n)},d=function(n){et(n)},y=function(n){f.$$apply=!0;g(n)},it=function(n){g(n)},rt=function(){e.bind("touchstart",tt);e.bind("mousedown",function(n){nt=u(function(){tt(n)},f.dragDelay)});e.bind("mouseup",function(){u.cancel(nt)})};rt();angular.element(i.document.body).bind("keydown",function(n){n.keyCode==27&&(f.$$apply=!1,g(n))})}}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTreeHandle",["treeConfig","$window",function(n){return{require:"^uiTreeNode",restrict:"A",scope:!0,controller:"TreeHandleController",link:function(t,i,r,u){var f={};angular.extend(f,n);f.handleClass&&i.addClass(f.handleClass);t!=u.scope&&(t.$nodeScope=u.scope,u.scope.$handleScope=t)}}}])}();
