@using Billing.Api.ViewModels
@Html.Partial("Shared/PageHeader", new HeaderViewModel("Pre Billing", ""))

<div class="box">
    
    <div id="transactionRange" class="pull-left" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; float: left;">
        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
        <span></span> <b class="caret"></b>
    </div>

    <table id="table"></table>
    
    <h2 id="detail-table-header"></h2>
    <table id="detail"></table>
 
    <script src="~/Scripts/app/pre_data.js"></script>

    <script>

        // Init
        var startDateFilter = moment({ day: 25 }).format('YYYY-MM-DD');
        var endDateFilter = moment({ day: 26 }).subtract(1, 'month').format('YYYY-MM-DD');

        $('#table').bootstrapTable({
            url: '/PreBilling',
            search: true,
            showRefresh: true,
            showColumns: true,
            pagination: true,
            pageNumber: 1,
            pageSize: 10,
            pageList: [10, 25, 50, 100, 'All'],
            columns: [{
                field: 'id',
                title: 'Item ID',
                visible: false
            }, {
                field: 'customerName',
                title: 'Customer Name',
                sortable: true
            }, {
                field: 'users',
                title: '# Users',
                formatter: gridUsersFormatter,
                events: userGridActionEvents
            }, {
                field: 'type',
                title: 'Customer / Client Type',
                sortable: true
            }, {
                field: 'owner',
                title: 'Owner',
                sortable: true
            }, {
                field: 'products',
                title: '# Packages',
                formatter: gridPackagesFormatter,
                events: packageGridActionEvents
            }, {
                field: 'transactions',
                title: '# Transactions',
                formatter: gridTransactionsFormatter
            }]
        });

        Billing.Common();

        //Hook to feed back to API
        $('#transactionRange').on('apply.daterangepicker', function (ev, picker) {

            startDateFilter = picker.endDate.format('YYYY-MM-DD');
            endDateFilter = picker.startDate.format('YYYY-MM-DD');

            $('#table').bootstrapTable('destroy');

            $('#table').bootstrapTable({
                url: '/PreBilling?startDate=' + startDateFilter + '&endDate=' + endDateFilter,
                search: true,
                showRefresh: true,
                showColumns: true,
                pagination: true,
                pageNumber: 1,
                pageSize: 10,
                pageList: [10, 25, 50, 100, 'All'],
                columns: [{
                    field: 'id',
                    title: 'Item ID',
                    visible: false
                }, {
                    field: 'customerName',
                    title: 'Customer Name',
                    sortable: true
                }, {
                    field: 'users',
                    title: '# Users',
                    formatter: gridUsersFormatter,
                    events: userGridActionEvents
                }, {
                    field: 'type',
                    title: 'Customer / Client Type',
                    sortable: true
                }, {
                    field: 'owner',
                    title: 'Owner',
                    sortable: true
                }, {
                    field: 'products',
                    title: '# Packages',
                    formatter: gridPackagesFormatter,
                    events: packageGridActionEvents
                }, {
                    field: 'transactions',
                    title: '# Transactions',
                    formatter: gridTransactionsFormatter
                }]
            });
        });
    </script>
</div>